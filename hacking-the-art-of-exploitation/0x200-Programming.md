#### 0x200 Programming

```Assembly language``` ----Assembler----&rightarrow; ```Machine language```

```High-level language``` ----Compiler----&rightarrow; ```Machine language```

###### Pseudo-code

- English like 
- Arranged with a general structure 
- Similar to a high-level language

###### Control Structures

- If-Then-Else

```
If (condition) then 
{	Set of instructions to execute if the condition is met;} 
Else 
{	Set of instruction to execute if the condition is not met;}
```

- While/Until Loops

```
While (you are hungry) 
{	Find some food;	Eat the food; 
}
```

```
Until (you are not hungry) 
{	Find some food;	Eat the food; 
}
```

- For Loops

```
for (i=0; i<5; i++)
{
	Drive straight for 1 mile;
}
```

###### More Fundamental Programming Concepts

- Variables
	- Variables
	- Constants

```
int a, b; 
float k; 
char z;
```

```
int a = 13, b; 
float k;char z = 'A';
k = 3.14; 
z = 'w';b = a + 5;
```

- Arithmetic Operators

Operation | Symbol | Example
----------|--------|---------Addition 	| + | b = a + 5
Subtraction | - | b = a - 5
Multiplication | * | b = a * 5
Division | / | b = a / 5Modulo reduction | % | b = a % 5Full Expression | Shorthand | Explanation
----------------|-----------|-----------------
i = i + 1 | i++ or ++i | Add 1 to the variable
i = i - 1 | i-- or --i | Subtract 1 from the variable

Full Expression | Shorthand | Explanation
----------------|-----------|-----------------
i = i + 12 | i+=12 | Add some value to the variable.
i = i - 12 | i-=12 | Subtract some value from the variable.
i = i * 12 | i*=12 | Multiply some value by the variable.
i = i / 12 | i/=12 | Divide some value from the variable.

- Comparison Operators

Condition | Symbol | Example
----------|--------|-------------
Less than | < | (a<b)
Greater than | > | (a>b)
Less than or equal to | <= | (a<=b)
Greater than or equal to | >= | (a>=b)
Equal to | == | (a==b)
Not equal to | != | (a!=b)

Logic | Symbol | Example
------|--------|-------------
OR | ```||``` | ((a < b) || (a < c))
AND | ```&&``` | ((a < b) && !(a < c))

- Functions

```
int factorial(int x) 
{	int i;	for(i=1; i < x; i++)    	x *= i;  	return x;}```

```
int a = 5, b;b = factorial(a);
```

```
int factorial(int);
```

###### Getting your hands dirty

- Location of header files

```/usr/include```

- ```GCC``` Version

```sh
root@kali:~/hacking/booksrc# gcc --version
gcc (Debian 6.3.0-12) 6.3.0 20170406
Copyright (C) 2016 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

root@kali:~/hacking/booksrc#
```

- Write and Compile ```C``` programs

```sh
root@kali:~/hacking/booksrc# cat firstprog.c
#include <stdio.h>

int main()
{
  int i;
  for(i=0; i < 10; i++)
  {
    printf("Hello World!\n");
  }
}
root@kali:~/hacking/booksrc#
```

```sh
root@kali:~/hacking/booksrc# gcc firstprog.c -o firstprog
```

```sh
root@kali:~/hacking/booksrc# file firstprog
firstprog: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=84d59dc5f956badc162523dcaa2dc18e0fe5be5a, not stripped
root@kali:~/hacking/booksrc#
```

```sh
root@kali:~/hacking/booksrc# ./firstprog
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
Hello World!
root@kali:~/hacking/booksrc#
```

- Machine code of the ```main()``` function

	- AT&T

	```sh
	root@kali:~/hacking/booksrc# objdump -D firstprog | grep -A 36 main.:
	00000590 <main>:
	 590:	8d 4c 24 04          	lea    0x4(%esp),%ecx
	 594:	83 e4 f0             	and    $0xfffffff0,%esp
	 597:	ff 71 fc             	pushl  -0x4(%ecx)
	 59a:	55                   	push   %ebp
	 59b:	89 e5                	mov    %esp,%ebp
	 59d:	53                   	push   %ebx
	 59e:	51                   	push   %ecx
	 59f:	83 ec 10             	sub    $0x10,%esp
	 5a2:	e8 b9 fe ff ff       	call   460 <__x86.get_pc_thunk.bx>
	 5a7:	81 c3 59 1a 00 00    	add    $0x1a59,%ebx
	 5ad:	c7 45 f4 00 00 00 00 	movl   $0x0,-0xc(%ebp)
	 5b4:	eb 16                	jmp    5cc <main+0x3c>
	 5b6:	83 ec 0c             	sub    $0xc,%esp
	 5b9:	8d 83 70 e6 ff ff    	lea    -0x1990(%ebx),%eax
	 5bf:	50                   	push   %eax
	 5c0:	e8 2b fe ff ff       	call   3f0 <puts@plt>
	 5c5:	83 c4 10             	add    $0x10,%esp
	 5c8:	83 45 f4 01          	addl   $0x1,-0xc(%ebp)
	 5cc:	83 7d f4 09          	cmpl   $0x9,-0xc(%ebp)
	 5d0:	7e e4                	jle    5b6 <main+0x26>
	 5d2:	b8 00 00 00 00       	mov    $0x0,%eax
	 5d7:	8d 65 f8             	lea    -0x8(%ebp),%esp
	 5da:	59                   	pop    %ecx
	 5db:	5b                   	pop    %ebx
	 5dc:	5d                   	pop    %ebp
	 5dd:	8d 61 fc             	lea    -0x4(%ecx),%esp
	 5e0:	c3                   	ret
	 5e1:	66 90                	xchg   %ax,%ax
	 5e3:	66 90                	xchg   %ax,%ax
	 5e5:	66 90                	xchg   %ax,%ax
	 5e7:	66 90                	xchg   %ax,%ax
	 5e9:	66 90                	xchg   %ax,%ax
	 5eb:	66 90                	xchg   %ax,%ax
	 5ed:	66 90                	xchg   %ax,%ax
	 5ef:	90                   	nop
	
	root@kali:~/hacking/booksrc#
	```

	- Intel

	```sh
	root@kali:~/hacking/booksrc# objdump -D firstprog -M intel | grep -A 36 main.:
	00000590 <main>:
	 590:	8d 4c 24 04          	lea    ecx,[esp+0x4]
	 594:	83 e4 f0             	and    esp,0xfffffff0
	 597:	ff 71 fc             	push   DWORD PTR [ecx-0x4]
	 59a:	55                   	push   ebp
	 59b:	89 e5                	mov    ebp,esp
	 59d:	53                   	push   ebx
	 59e:	51                   	push   ecx
	 59f:	83 ec 10             	sub    esp,0x10
	 5a2:	e8 b9 fe ff ff       	call   460 <__x86.get_pc_thunk.bx>
	 5a7:	81 c3 59 1a 00 00    	add    ebx,0x1a59
	 5ad:	c7 45 f4 00 00 00 00 	mov    DWORD PTR [ebp-0xc],0x0
	 5b4:	eb 16                	jmp    5cc <main+0x3c>
	 5b6:	83 ec 0c             	sub    esp,0xc
	 5b9:	8d 83 70 e6 ff ff    	lea    eax,[ebx-0x1990]
	 5bf:	50                   	push   eax
	 5c0:	e8 2b fe ff ff       	call   3f0 <puts@plt>
	 5c5:	83 c4 10             	add    esp,0x10
	 5c8:	83 45 f4 01          	add    DWORD PTR [ebp-0xc],0x1
	 5cc:	83 7d f4 09          	cmp    DWORD PTR [ebp-0xc],0x9
	 5d0:	7e e4                	jle    5b6 <main+0x26>
	 5d2:	b8 00 00 00 00       	mov    eax,0x0
	 5d7:	8d 65 f8             	lea    esp,[ebp-0x8]
	 5da:	59                   	pop    ecx
	 5db:	5b                   	pop    ebx
	 5dc:	5d                   	pop    ebp
	 5dd:	8d 61 fc             	lea    esp,[ecx-0x4]
	 5e0:	c3                   	ret
	 5e1:	66 90                	xchg   ax,ax
	 5e3:	66 90                	xchg   ax,ax
	 5e5:	66 90                	xchg   ax,ax
	 5e7:	66 90                	xchg   ax,ax
	 5e9:	66 90                	xchg   ax,ax
	 5eb:	66 90                	xchg   ax,ax
	 5ed:	66 90                	xchg   ax,ax
	 5ef:	90                   	nop
	
	root@kali:~/hacking/booksrc#
	```
	
###### The x86 Processor

- Registers
	- Internal Variables

General Purpose Register | Use
-------------------------|--------
EAX | Accumulator
EBX | Base
ECX | Counter
EDX | Data

Pointers & Indexes | Use
-------------------|------
ESP | Stack Pointer
EBP | Base Pointer
ESI | Source Index
EDI | Destination Index

```EIP```
	- Instruction Pointer
	- Points to the current instruction the processor is reading

[```EFLAGS```](http://www.c-jump.com/CIS77/ASM/Instructions/I77_0070_eflags_bits.htm)
	- Bit flags that are used for comparisons and memory segmentation


- Debugger
	- Step through the compiled program
	- Examine program memory
	- View processor registers

- GDB

```sh
root@kali:~/hacking/booksrc# gdb ./firstprog -q
Reading symbols from ./firstprog...(no debugging symbols found)...done.
(gdb) break main
Breakpoint 1 at 0x59f
(gdb) run
Starting program: /root/hacking/booksrc/firstprog

Breakpoint 1, 0x8000059f in main ()
(gdb) info registers
eax            0xb7fb2dbc	-1208275524
ecx            0xbffff680	-1073744256
edx            0xbffff6a4	-1073744220
ebx            0x0	0
esp            0xbffff660	0xbffff660
ebp            0xbffff668	0xbffff668
esi            0x1	1
edi            0xb7fb1000	-1208283136
eip            0x8000059f	0x8000059f <main+15>
eflags         0x282	[ SF IF ]
cs             0x73	115
ss             0x7b	123
ds             0x7b	123
es             0x7b	123
fs             0x0	0
gs             0x33	51
(gdb) quit
A debugging session is active.

	Inferior 1 [process 1605] will be killed.

Quit anyway? (y or n) y
root@kali:~/hacking/booksrc#
```

###### Assembly Language

- ```GDB``` init file to use ```Intel``` syntax

```sh
root@kali:~/hacking/booksrc# gdb -q
(gdb) set disassembly-flavor intel
(gdb) quit
root@kali:~/hacking/booksrc#
```

```sh
root@kali:~/hacking/booksrc# echo "set disassembly-flavor intel" > ~/.gdbinit
root@kali:~/hacking/booksrc# cat ~/.gdbinit
set disassembly-flavor intel
root@kali:~/hacking/booksrc#
```

- Intel Syntax

```
operation <destination>, <source>
```

```DWORD``` - 4 bytes

- Compile with debug information

```sh
root@kali:~/hacking/booksrc# gcc firstprog.c -o firstprog_debug -g
```

```sh
root@kali:~/hacking/booksrc# file firstprog_debug
firstprog_debug: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=f9594a9b7afa7598a838fee6af6531982c357267, not stripped
root@kali:~/hacking/booksrc#
```

```sh
root@kali:~/hacking/booksrc# gdb ./firstprog_debug -q
Reading symbols from ./firstprog_debug...done.
(gdb) list
1	#include <stdio.h>
2
3	int main()
4	{
5	  int i;
6	  for(i=0; i < 10; i++)
7	  {
8	    printf("Hello World!\n");
9	  }
10	}
(gdb) disassemble main
Dump of assembler code for function main:
   0x00000590 <+0>:	lea    ecx,[esp+0x4]
   0x00000594 <+4>:	and    esp,0xfffffff0
   0x00000597 <+7>:	push   DWORD PTR [ecx-0x4]
   0x0000059a <+10>:	push   ebp
   0x0000059b <+11>:	mov    ebp,esp
   0x0000059d <+13>:	push   ebx
   0x0000059e <+14>:	push   ecx
   0x0000059f <+15>:	sub    esp,0x10
   0x000005a2 <+18>:	call   0x460 <__x86.get_pc_thunk.bx>
   0x000005a7 <+23>:	add    ebx,0x1a59
   0x000005ad <+29>:	mov    DWORD PTR [ebp-0xc],0x0
   0x000005b4 <+36>:	jmp    0x5cc <main+60>
   0x000005b6 <+38>:	sub    esp,0xc
   0x000005b9 <+41>:	lea    eax,[ebx-0x1990]
   0x000005bf <+47>:	push   eax
   0x000005c0 <+48>:	call   0x3f0 <puts@plt>
   0x000005c5 <+53>:	add    esp,0x10
   0x000005c8 <+56>:	add    DWORD PTR [ebp-0xc],0x1
   0x000005cc <+60>:	cmp    DWORD PTR [ebp-0xc],0x9
   0x000005d0 <+64>:	jle    0x5b6 <main+38>
   0x000005d2 <+66>:	mov    eax,0x0
   0x000005d7 <+71>:	lea    esp,[ebp-0x8]
   0x000005da <+74>:	pop    ecx
   0x000005db <+75>:	pop    ebx
   0x000005dc <+76>:	pop    ebp
   0x000005dd <+77>:	lea    esp,[ecx-0x4]
   0x000005e0 <+80>:	ret
End of assembler dump.
(gdb) break main
Breakpoint 1 at 0x5ad: file firstprog.c, line 6.
(gdb) run
Starting program: /root/hacking/booksrc/firstprog_debug

Breakpoint 1, main () at firstprog.c:6
6	  for(i=0; i < 10; i++)
(gdb) info registers eip
eip            0x800005ad	0x800005ad <main+29>
(gdb)
```

EIP

```sh
   0x000005ad <+29>:	mov    DWORD PTR [ebp-0xc],0x0
```

Function Prolog

```sh
   0x00000590 <+0>:		lea    ecx,[esp+0x4]
   0x00000594 <+4>:		and    esp,0xfffffff0
   0x00000597 <+7>:		push   DWORD PTR [ecx-0x4]
   0x0000059a <+10>:	push   ebp
   0x0000059b <+11>:	mov    ebp,esp
   0x0000059d <+13>:	push   ebx
   0x0000059e <+14>:	push   ecx
   0x0000059f <+15>:	sub    esp,0x10
   0x000005a2 <+18>:	call   0x460 <__x86.get_pc_thunk.bx>
   0x000005a7 <+23>:	add    ebx,0x1a59
```

- Examine - ```x```
	- 2 arguments
		- Location of memory to examine
		- How to display the memory
			- display is preceded by a count of how many items to examine

Display format Shorthand | Display format
-------------------------|------------------
o | Octal
x | hexadecimal
u | unsigned, standard base-10 decimal
t | binary

```sh
(gdb) i r eip
eip            0x800005ad	0x800005ad <main+29>
(gdb) x/o 0x800005ad
0x800005ad <main+29>:	075042707
(gdb) x/x 0x800005ad
0x800005ad <main+29>:	0x00f445c7
(gdb) x/u 0x800005ad
0x800005ad <main+29>:	16008647
(gdb) x/t 0x800005ad
0x800005ad <main+29>:	00000000111101000100010111000111
(gdb)
```

```sh
(gdb) x/2x $eip
0x800005ad <main+29>:	0x00f445c7	0xeb000000
(gdb) x/12x $eip
0x800005ad <main+29>:	0x00f445c7	0xeb000000	0x0cec8316	0xe670838d
0x800005bd <main+45>:	0xe850ffff	0xfffffe2b	0x8310c483	0x8301f445
0x800005cd <main+61>:	0x7e09f47d	0x0000b8e4	0x658d0000	0x5d5b59f8
(gdb)
```

Size Alphabet | Size
--------------|--------
b | 1 byte
h | Halfword - 2 bytes
w | Word - 4 bytes
g | Giant - 8 bytes

_**Sometimes ```DWORD``` and ```WORD``` both are 4 bytes**_


```sh
(gdb) x/8xb $eip
0x800005ad <main+29>:	0xc7	0x45	0xf4	0x00	0x00	0x00	0x00	0xeb
(gdb) x/8xh $eip
0x800005ad <main+29>:	0x45c7	0x00f4	0x0000	0xeb00	0x8316	0x0cec	0x838d	0xe670
(gdb) x/8xw $eip
0x800005ad <main+29>:	0x00f445c7	0xeb000000	0x0cec8316	0xe670838d
0x800005bd <main+45>:	0xe850ffff	0xfffffe2b	0x8310c483	0x8301f445
(gdb) x/8xg $eip
0x800005ad <main+29>:	0xeb00000000f445c7	0xe670838d0cec8316
0x800005bd <main+45>:	0xfffffe2be850ffff	0x8301f4458310c483
0x800005cd <main+61>:	0x0000b8e47e09f47d	0x5d5b59f8658d0000
0x800005dd <main+77>:	0x90669066c3fc618d	0x9066906690669066
(gdb)
```